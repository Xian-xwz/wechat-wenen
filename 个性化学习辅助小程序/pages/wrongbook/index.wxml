<!-- 错题本页面 -->
<view class="wrongbook-page">
  <!-- 导航栏 -->
  <t-navbar title="错题本" left-arrow class="navbar" />
  
  <!-- 统计卡片 -->
  <view class="stats-card">
    <view class="stats-item">
      <text class="stats-value">{{wrongList.length}}</text>
      <text class="stats-label">错题总数</text>
    </view>
    <view class="stats-item">
      <text class="stats-value">{{masteredCount}}</text>
      <text class="stats-label">已掌握</text>
    </view>
    <view class="stats-item">
      <text class="stats-value">{{needReviewCount}}</text>
      <text class="stats-label">待复习</text>
    </view>
  </view>

  <!-- 知识点筛选 -->
  <view class="filter-bar">
    <scroll-view scroll-x class="filter-scroll">
      <view 
        class="filter-item {{currentFilter === 'all' ? 'filter-item--active' : ''}}"
        bindtap="setFilter"
        data-filter="all"
      >
        全部
      </view>
      <view 
        wx:for="{{knowledgePoints}}" 
        wx:key="index"
        class="filter-item {{currentFilter === item ? 'filter-item--active' : ''}}"
        bindtap="setFilter"
        data-filter="{{item}}"
      >
        {{item}}
      </view>
    </scroll-view>
  </view>

  <!-- 错题列表 -->
  <scroll-view 
    class="wrong-list" 
    scroll-y
    refresher-enabled
    bindrefresherrefresh="onRefresh"
    refresher-triggered="{{isRefreshing}}"
  >
    <view 
      wx:for="{{filteredList}}" 
      wx:key="id"
      class="wrong-card"
      bindtap="viewDetail"
      data-id="{{item.id}}"
    >
      <view class="card-header">
        <t-tag size="small" variant="light">{{item.knowledgePoint}}</t-tag>
        <text class="wrong-time">{{item.wrongTime}}</text>
      </view>

      <view class="card-content">
        <text class="question-title">{{item.title}}</text>
        <view class="wrong-answer">
          <text class="answer-label">你的答案：</text>
          <text class="answer-text answer-text--wrong">{{item.options[item.wrongAnswer]}}</text>
        </view>
        <view class="correct-answer">
          <text class="answer-label">正确答案：</text>
          <text class="answer-text answer-text--correct">{{item.options[item.correct]}}</text>
        </view>
      </view>

      <view class="card-footer">
        <view class="error-count">
          <t-icon name="error-circle" size="24rpx" color="#FF4D4F" />
          <text>错 {{item.errorCount}} 次</text>
        </view>
        <view class="review-btn" catchtap="markAsReviewed" data-id="{{item.id}}">
          <text>{{item.isReviewed ? '已复习' : '标记复习'}}</text>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{filteredList.length === 0}}">
      <t-icon name="file-copy" size="80rpx" color="#ccc" />
      <text class="empty-title">暂无错题</text>
      <text class="empty-desc">快去刷题，错题会自动收录到这里</text>
      <t-button theme="primary" size="medium" bindtap="goToQuiz">去刷题</t-button>
    </view>
  </scroll-view>
</view>
