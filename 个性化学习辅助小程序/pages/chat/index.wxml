<!-- 学习智能体页面 -->
<t-navbar class="nav-bar" title="学习助手" left-arrow />

<view class="assistant-container">
  <!-- 欢迎语 -->
  <view class="welcome-card" wx:if="{{messages.length === 0}}">
    <view class="welcome-icon">🎓</view>
    <view class="welcome-title">我是你的学习助手</view>
    <view class="welcome-desc">我可以帮你解答学习问题、分析学习情况、推荐学习内容</view>
  </view>

  <!-- 建议卡片 -->
  <view class="suggestion-cards" wx:if="{{showSuggestions && messages.length === 0}}">
    <view class="suggestion-title">为你推荐</view>
    <view 
      wx:for="{{suggestions}}" 
      wx:key="index"
      class="suggestion-card"
      bindtap="sendSuggestion"
      data-text="{{item.text}}"
    >
      <text class="suggestion-text">{{item.title}}</text>
      <t-icon name="chevron-right" size="32rpx" color="#999" />
    </view>
  </view>

  <!-- 消息列表 -->
  <scroll-view class="content" scroll-y scroll-into-view="{{anchor}}">
    <view class="messages">
      <block wx:for="{{messages}}" wx:key="index">
        <view wx:if="{{item.type === 'user'}}" class="message-area user">
          <view class="message-bubble user">
            <text>{{item.content}}</text>
          </view>
          <t-avatar image="{{userAvatar}}" size="small" />
        </view>

        <view wx:else class="message-area assistant">
          <t-avatar image="/static/assistant-avatar.png" size="small" />
          <view class="message-content">
            <view class="message-bubble assistant">
              <text>{{item.content}}</text>
            </view>
            
            <!-- 快捷操作按钮 -->
            <view class="quick-actions" wx:if="{{item.quickActions}}">
              <view 
                wx:for="{{item.quickActions}}" 
                wx:for-item="action"
                wx:key="index"
                class="quick-action-btn"
                bindtap="sendSuggestion"
                data-text="{{action}}"
              >
                {{action}}
              </view>
            </view>

            <!-- 反馈按钮 -->
            <view class="feedback-bar" wx:if="{{!item.feedback}}">
              <view class="feedback-btn" bindtap="giveFeedback" data-index="{{index}}" data-type="helpful">
                <t-icon name="thumb-up" size="24rpx" color="#999" />
                <text>有帮助</text>
              </view>
              <view class="feedback-btn" bindtap="giveFeedback" data-index="{{index}}" data-type="unhelpful">
                <t-icon name="thumb-down" size="24rpx" color="#999" />
                <text>没帮助</text>
              </view>
            </view>
            <view class="feedback-result" wx:if="{{item.feedback}}">
              <text>感谢您的反馈！</text>
            </view>
          </view>
        </view>
      </block>
      <view id="bottom" />
    </view>
  </scroll-view>
</view>

<!-- 快捷问题 -->
<view class="quick-questions" wx:if="{{showQuickQuestions}}">
  <scroll-view scroll-x class="quick-questions-scroll">
    <view 
      wx:for="{{quickQuestions}}" 
      wx:key="index"
      class="quick-question-item"
      bindtap="sendSuggestion"
      data-text="{{item}}"
    >
      {{item}}
    </view>
  </scroll-view>
</view>

<view class="block" style="margin-bottom: {{keyboardHeight}}px" />
<view class="bottom" style="margin-bottom: {{keyboardHeight}}px">
  <view class="input">
    <input
      value="{{input}}"
      type="text"
      confirm-type="send"
      placeholder="输入你的学习问题..."
      placeholder-style="color: #999"
      adjust-position="{{false}}"
      hold-keyboard
      confirm-hold
      bindkeyboardheightchange="handleKeyboardHeightChange"
      bindblur="handleBlur"
      bindinput="handleInput"
      bindconfirm="sendMessage"
    />
  </view>
  <t-button class="send" theme="primary" shape="round" disabled="{{!input}}" bind:tap="sendMessage">发送</t-button>
</view>
